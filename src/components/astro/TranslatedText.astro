---
import { useTranslations, getLangFromUrl } from "../../i18n/utils";
import { NavLang } from "../../i18n/navTranslations";

interface Props {
  translationKey: keyof (typeof NavLang)["en"];
}

const { translationKey } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<span data-translation-key={translationKey} class="translated-text">
  {t(translationKey)}
</span>

<script define:vars={{ NavLang }}>
  if (!window.translationListenerAdded) {
    window.translationListenerAdded = true;

    window.addEventListener("languageChange", (e) => {
      const { lang } = e.detail;
      document.querySelectorAll(".translated-text").forEach((element) => {
        const key = element.getAttribute("data-translation-key");
        if (key && lang in NavLang && key in NavLang[lang]) {
          const translation = NavLang[lang][key];
          element.textContent = translation;
        } else {
          console.warn(`Translation missing for key: ${key} in language: ${lang}`);
        }
      });
    });
  }
</script>

<script>
  declare global {
    interface WindowEventMap {
      languageChange: CustomEvent<{ lang: string }>;
    }
    interface Window {
      translationListenerAdded?: boolean;
    }
  }
</script>
